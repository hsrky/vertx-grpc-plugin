{{#packageName}}
package {{packageName}};
{{/packageName}}

import io.vertx.core.Future;
import io.vertx.core.Handler;
import io.vertx.core.Vertx;
import io.vertx.core.http.HttpServerRequest;
import io.vertx.grpc.server.GrpcServer;
import io.vertx.grpc.server.GrpcServerRequest;
import com.lwlee2608.vertx.grpc.plugin.GrpcStreamRequest;
import com.lwlee2608.vertx.grpc.plugin.GrpcStreamResponse;

import java.util.ArrayList;
import java.util.List;

public class {{className}}  {
    private final GrpcServer server;

    public {{className}}(Vertx vertx) {
        this.server = GrpcServer.server(vertx);
    }

    public interface {{serviceName}}Api {
{{#unaryMethods}}
        Future<{{outputType}}> {{methodName}}({{inputType}} request);
{{/unaryMethods}}
{{#unaryManyMethods}}
        void {{methodName}}({{inputType}} request, GrpcStreamResponse<{{outputType}}> response);
{{/unaryManyMethods}}
{{#manyUnaryMethods}}
        Future<{{outputType}}> {{methodName}}(GrpcStreamRequest<{{inputType}}> request);
{{/manyUnaryMethods}}
{{#manyManyMethods}}
        void {{methodName}}(GrpcStreamRequest<{{inputType}}> request, GrpcStreamResponse<{{outputType}}> response);
{{/manyManyMethods}}
    }

    public {{className}} callHandlers({{serviceName}}Api implementation) {
{{#unaryMethods}}
        server.callHandler({{serviceName}}Grpc.{{methodNameGetter}}(), request ->
                request.handler(req -> implementation.{{methodName}}(req)
                    .onSuccess(resp -> request.response().end(resp))
                ));
{{/unaryMethods}}
{{#unaryManyMethods}}
        server.callHandler({{serviceName}}Grpc.{{methodNameGetter}}(), request ->request.handler(req -> implementation.{{methodName}}(req, new GrpcStreamResponse<>(request.response()))));
{{/unaryManyMethods}}
{{#manyUnaryMethods}}
        server.callHandler({{serviceName}}Grpc.{{methodNameGetter}}(), request ->implementation.{{methodName}}(new GrpcStreamRequest<>(request)).onSuccess(resp -> request.response().end(resp)));
{{/manyUnaryMethods}}
{{#manyManyMethods}}
        server.callHandler({{serviceName}}Grpc.{{methodNameGetter}}(), request ->implementation.{{methodName}}(new GrpcStreamRequest<>(request), new GrpcStreamResponse<>(request.response())));
{{/manyManyMethods}}
        return this;
    }

    public Handler<HttpServerRequest> getGrpcServer() {
        return server;
    }
}